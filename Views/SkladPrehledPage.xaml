<Page
    x:Class="Sklad_2.Views.SkladPrehledPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Sklad_2.Models"
    xmlns:viewmodels="using:Sklad_2.ViewModels"
    xmlns:converters="using:Sklad_2.Converters"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    Loaded="Page_Loaded">
    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/Controls.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <converters:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
            <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        </ResourceDictionary>
    </Page.Resources>

    <ScrollViewer>
        <Grid Padding="24" RowSpacing="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <TextBlock Grid.Row="0" Text="Sklad (Přehled)" Style="{ThemeResource TitleTextBlockStyle}"/>

            <!-- Filters -->
            <Grid Grid.Row="1" RowSpacing="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Date & Type Filters -->
                <Grid Grid.Row="0" ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Date Filter -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4">
                        <RadioButton Content="Denní" Style="{StaticResource ToggleButtonStyle}"
                                     IsChecked="{x:Bind ViewModel.SelectedDateFilter, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Daily, Mode=OneWay}"
                                     Checked="DateFilter_Checked" Tag="Daily"/>
                        <RadioButton Content="Týdenní" Style="{StaticResource ToggleButtonStyle}"
                                     IsChecked="{x:Bind ViewModel.SelectedDateFilter, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Weekly, Mode=OneWay}"
                                     Checked="DateFilter_Checked" Tag="Weekly"/>
                        <RadioButton Content="Měsíční" Style="{StaticResource ToggleButtonStyle}"
                                     IsChecked="{x:Bind ViewModel.SelectedDateFilter, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Monthly, Mode=OneWay}"
                                     Checked="DateFilter_Checked" Tag="Monthly"/>
                        <RadioButton Content="Vlastní" Style="{StaticResource ToggleButtonStyle}"
                                     IsChecked="{x:Bind ViewModel.SelectedDateFilter, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Custom, Mode=OneWay}"
                                     Checked="DateFilter_Checked" Tag="Custom"/>
                    </StackPanel>

                    <!-- Type Filter ComboBox -->
                    <ComboBox Grid.Column="1"
                              Header="Typ pohybu"
                              ItemsSource="{x:Bind ViewModel.TypeFilterOptions, Mode=OneWay}"
                              SelectedItem="{x:Bind ViewModel.SelectedTypeFilter, Mode=TwoWay}"
                              DisplayMemberPath="Name"
                              MinWidth="200"
                              HorizontalAlignment="Left"/>
                </Grid>

                <!-- Custom Date Range & Product Search -->
                <Grid Grid.Row="1" ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Custom Date Range -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8"
                                Visibility="{x:Bind ViewModel.IsCustomFilterVisible, Mode=OneWay}">
                        <CalendarDatePicker Header="Od" Date="{x:Bind ViewModel.FilterStartDate, Mode=TwoWay}" HorizontalAlignment="Stretch"/>
                        <CalendarDatePicker Header="Do" Date="{x:Bind ViewModel.FilterEndDate, Mode=TwoWay}" HorizontalAlignment="Stretch"/>
                    </StackPanel>

                    <!-- Product Search -->
                    <TextBox Grid.Column="1"
                             Header="Hledat produkt (EAN nebo název)"
                             Text="{x:Bind ViewModel.SearchProductText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             PlaceholderText="Zadejte EAN nebo název produktu..."
                             MinWidth="300"
                             HorizontalAlignment="Stretch"/>
                </Grid>
            </Grid>

            <!-- Movements List -->
            <Border Grid.Row="2" Style="{StaticResource CardBorderStyle}" Shadow="{ThemeResource CardShadow}">
                <ListView ItemsSource="{x:Bind ViewModel.Movements, Mode=OneWay}"
                          SelectionMode="None">
                    <ListView.HeaderTemplate>
                        <DataTemplate>
                            <Grid Padding="12" Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1.5*"/>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="1.2*"/>
                                    <ColumnDefinition Width="1*"/>
                                    <ColumnDefinition Width="0.8*"/>
                                    <ColumnDefinition Width="0.8*"/>
                                    <ColumnDefinition Width="1.2*"/>
                                    <ColumnDefinition Width="1.5*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Datum" FontWeight="Bold"/>
                                <TextBlock Grid.Column="1" Text="Produkt" FontWeight="Bold"/>
                                <TextBlock Grid.Column="2" Text="Typ pohybu" FontWeight="Bold"/>
                                <TextBlock Grid.Column="3" Text="Změna" FontWeight="Bold"/>
                                <TextBlock Grid.Column="4" Text="Před" FontWeight="Bold"/>
                                <TextBlock Grid.Column="5" Text="Po" FontWeight="Bold"/>
                                <TextBlock Grid.Column="6" Text="Uživatel" FontWeight="Bold"/>
                                <TextBlock Grid.Column="7" Text="Poznámka" FontWeight="Bold"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.HeaderTemplate>
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:StockMovement">
                            <Grid Padding="12" ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1.5*"/>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="1.2*"/>
                                    <ColumnDefinition Width="1*"/>
                                    <ColumnDefinition Width="0.8*"/>
                                    <ColumnDefinition Width="0.8*"/>
                                    <ColumnDefinition Width="1.2*"/>
                                    <ColumnDefinition Width="1.5*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="{x:Bind TimestampFormatted}"
                                           VerticalAlignment="Center"
                                           FontSize="12"/>

                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                                    <TextBlock Text="{x:Bind ProductName}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{x:Bind ProductEan}" FontSize="11" Opacity="0.7"/>
                                </StackPanel>

                                <TextBlock Grid.Column="2"
                                           Text="{x:Bind MovementTypeFormatted}"
                                           VerticalAlignment="Center"/>

                                <TextBlock Grid.Column="3"
                                           Text="{x:Bind QuantityChangeFormatted}"
                                           VerticalAlignment="Center"
                                           FontWeight="Bold">
                                    <TextBlock.Foreground>
                                        <SolidColorBrush Color="{ThemeResource SystemAccentColor}" Opacity="{x:Bind IsPositiveChange, Converter={StaticResource BooleanToOpacityConverter}}"/>
                                    </TextBlock.Foreground>
                                </TextBlock>

                                <TextBlock Grid.Column="4"
                                           Text="{x:Bind StockBefore}"
                                           VerticalAlignment="Center"
                                           Opacity="0.7"/>

                                <TextBlock Grid.Column="5"
                                           Text="{x:Bind StockAfter}"
                                           VerticalAlignment="Center"
                                           FontWeight="SemiBold"/>

                                <TextBlock Grid.Column="6"
                                           Text="{x:Bind UserName}"
                                           VerticalAlignment="Center"/>

                                <TextBlock Grid.Column="7"
                                           Text="{x:Bind Notes}"
                                           VerticalAlignment="Center"
                                           TextWrapping="Wrap"
                                           FontSize="11"
                                           Opacity="0.7"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Border>
        </Grid>
    </ScrollViewer>
</Page>
