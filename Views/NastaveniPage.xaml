<Page
    x:Name="page"
    x:Class="Sklad_2.Views.NastaveniPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Sklad_2.Models"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Padding="24">
            <NavigationView
                PaneDisplayMode="Top"
                IsSettingsVisible="False"
                IsBackButtonVisible="Collapsed"
                ItemInvoked="NavView_ItemInvoked"
                AlwaysShowHeader="False">
                <NavigationView.MenuItems>
                    <NavigationViewItem Content="Firemní údaje" Tag="Company" IsSelected="True"/>
                    <NavigationViewItem Content="Sazby DPH" Tag="VAT" Visibility="{x:Bind ViewModel.IsVatPayer, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}"/>
                    <NavigationViewItem Content="Kategorie" Tag="Categories" Visibility="{x:Bind ViewModel.IsAdmin, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}"/>
                    <NavigationViewItem Content="Uživatelé" Tag="Users" Visibility="{x:Bind ViewModel.IsAdmin, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}"/>
                    <NavigationViewItem Content="Hesla" Tag="Passwords" Visibility="{x:Bind ViewModel.IsAdmin, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}"/>
                    <NavigationViewItem Content="Systém" Tag="System"/>
                    <NavigationViewItem Content="O aplikaci" Tag="About"/>
                </NavigationView.MenuItems>

                <Grid Padding="0,12,0,0">
                    <!-- Company Settings Panel -->
                    <ScrollViewer x:Name="CompanySettingsPanel" Visibility="Visible" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Firemní údaje" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                Nastavte základní informace o vaší firmě. Tyto údaje se zobrazují na účtenkách a dokladech.
                            </TextBlock>

                            <!-- Company Info Form -->
                            <StackPanel Spacing="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBox Header="Název obchodu"
                                         Text="{x:Bind ViewModel.Settings.ShopName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Např. Můj obchod s.r.o."
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <TextBox Header="Adresa"
                                         Text="{x:Bind ViewModel.Settings.ShopAddress, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Např. Hlavní 123, 110 00 Praha"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <TextBox Header="IČ (Identifikační číslo)"
                                         Text="{x:Bind ViewModel.Settings.CompanyId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Např. 12345678"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <TextBox Header="DIČ (Daňové identifikační číslo)"
                                         Text="{x:Bind ViewModel.Settings.VatId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Např. CZ12345678"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <ToggleSwitch Header="Plátce DPH"
                                              OnContent="Ano"
                                              OffContent="Ne"
                                              IsOn="{x:Bind ViewModel.Settings.IsVatPayer, Mode=TwoWay}"
                                              IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                            </StackPanel>

                            <!-- Save Button -->
                            <Button Content="Uložit firemní údaje"
                                    Command="{x:Bind ViewModel.SaveCompanyInfoCommand}"
                                    Style="{StaticResource AccentButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                            <!-- Status Message -->
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="12"
                                    Visibility="{x:Bind ViewModel.CompanyStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                <TextBlock Text="{x:Bind ViewModel.CompanyStatusMessage, Mode=OneWay}"
                                           TextWrapping="Wrap"
                                           Foreground="{x:Bind ViewModel.IsCompanyStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- VAT Settings Panel -->
                    <ScrollViewer x:Name="VatSettingsPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Konfigurace sazeb DPH" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                Nastavte sazby DPH pro jednotlivé kategorie produktů. Změny kategorií se automaticky projeví v tomto seznamu.
                            </TextBlock>

                            <!-- VAT Configs List -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <Grid ColumnDefinitions="*,Auto" Padding="0,0,0,12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,0,0,2">
                                    <TextBlock Grid.Column="0" Text="Kategorie" FontWeight="SemiBold" />
                                    <TextBlock Grid.Column="1" Text="Sazba DPH (%)" FontWeight="SemiBold" />
                                </Grid>
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.VatConfigs, Mode=OneWay}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate x:DataType="models:VatConfig">
                                            <Grid ColumnDefinitions="*,Auto" Padding="0,12,0,12" VerticalAlignment="Center" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,0,0,1">
                                                <TextBlock Grid.Column="0" Text="{x:Bind CategoryName}" VerticalAlignment="Center" FontSize="14"/>
                                                <NumberBox Grid.Column="1"
                                                           Value="{x:Bind Rate, Mode=TwoWay}"
                                                           SpinButtonPlacementMode="Compact"
                                                           SmallChange="1"
                                                           LargeChange="5"
                                                           Minimum="0"
                                                           Maximum="100"
                                                           Width="140"
                                                           IsEnabled="{Binding DataContext.IsAdmin, ElementName=page, Mode=OneWay}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </StackPanel>

                            <!-- Save Button -->
                            <Button Content="Uložit sazby DPH"
                                    Command="{x:Bind ViewModel.SaveVatConfigsCommand}"
                                    Style="{StaticResource AccentButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                            <!-- Status Message -->
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="12"
                                    Visibility="{x:Bind ViewModel.VatStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                <TextBlock Text="{x:Bind ViewModel.VatStatusMessage, Mode=OneWay}"
                                           TextWrapping="Wrap"
                                           Foreground="{x:Bind ViewModel.IsVatStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Password Settings Panel -->
                    <ScrollViewer x:Name="PasswordSettingsPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Správa hesel" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                Změňte hesla pro přístup do aplikace. Heslo pro roli Admin je povinné, heslo pro roli Prodej je volitelné.
                            </TextBlock>

                            <!-- Admin Password Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Změna hesla pro Admina" FontWeight="SemiBold"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Heslo musí být vyplněno a obě pole musí souhlasit.
                                </TextBlock>
                                <PasswordBox x:Name="NewAdminPasswordBox"
                                             Header="Nové heslo"
                                             PasswordChanged="NewAdminPasswordBox_PasswordChanged"
                                             PlaceholderText="Zadejte nové heslo"/>
                                <PasswordBox x:Name="ConfirmAdminPasswordBox"
                                             Header="Potvrzení nového hesla"
                                             PasswordChanged="ConfirmAdminPasswordBox_PasswordChanged"
                                             PlaceholderText="Zadejte heslo znovu"/>
                                <Button Content="Změnit heslo Admina"
                                        Command="{x:Bind ViewModel.ChangeAdminPasswordCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        HorizontalAlignment="Stretch"/>

                                <!-- Admin Password Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.AdminPasswordStatus, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.AdminPasswordStatus, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>

                            <!-- Sale Password Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Nastavení hesla pro roli Prodej" FontWeight="SemiBold"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Ponechte prázdné pro uzamčení role Prodej. Vyplněním hesla povolíte přístup pro tuto roli.
                                </TextBlock>
                                <PasswordBox x:Name="NewSalePasswordBox"
                                             Header="Heslo pro 'Prodej'"
                                             PasswordChanged="NewSalePasswordBox_PasswordChanged"
                                             PlaceholderText="Ponechte prázdné pro uzamčení"/>
                                <Button Content="Nastavit heslo pro 'Prodej'"
                                        Command="{x:Bind ViewModel.ChangeSalePasswordCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        HorizontalAlignment="Stretch"/>

                                <!-- Sale Password Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.SalePasswordStatus, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.SalePasswordStatus, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Users Panel -->
                    <ScrollViewer x:Name="UsersPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Správa uživatelů" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                Spravujte uživatelské účty pro přístup do aplikace. Každý uživatel má jedinečné přihlašovací jméno, zobrazované jméno a roli.
                            </TextBlock>

                            <!-- Users List -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Uživatelé:" FontWeight="SemiBold"/>
                                <ListView ItemsSource="{x:Bind UserMgmtVM.Users, Mode=OneWay}"
                                          SelectedItem="{x:Bind UserMgmtVM.SelectedUser, Mode=TwoWay}"
                                          MaxHeight="300"
                                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                          BorderThickness="1">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="models:User">
                                            <Grid ColumnSpacing="12" Padding="8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="2*"/>
                                                    <ColumnDefinition Width="2*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <FontIcon Grid.Column="0" Glyph="{x:Bind Role, Converter={StaticResource RoleToIconConverter}}" FontSize="16"/>
                                                <TextBlock Grid.Column="1" Text="{x:Bind Username}" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="2" Text="{x:Bind DisplayName}" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="3" Text="{x:Bind RoleDisplayName}" VerticalAlignment="Center"/>
                                                <Border Grid.Column="4"
                                                        Background="{x:Bind IsActive, Converter={StaticResource BooleanToColorConverter}}"
                                                        CornerRadius="10"
                                                        Padding="8,2">
                                                    <TextBlock Text="{x:Bind StatusDisplayName}"
                                                               FontSize="11"
                                                               Foreground="White"
                                                               FontWeight="SemiBold"/>
                                                </Border>
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>

                            <!-- Add User -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Přidat nového uživatele" FontWeight="SemiBold"/>
                                <Button Content="+ Přidat uživatele"
                                        Command="{x:Bind UserMgmtVM.AddUserCommand}"
                                        Style="{StaticResource AccentButtonStyle}"/>
                            </StackPanel>

                            <!-- Edit User -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Upravit uživatele" FontWeight="SemiBold"/>
                                <TextBlock Text="Vyberte uživatele ze seznamu a upravte jeho údaje:" TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <Button Content="Upravit vybraného uživatele"
                                        Command="{x:Bind UserMgmtVM.EditUserCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        IsEnabled="{x:Bind UserMgmtVM.IsUserSelected, Mode=OneWay}"/>
                            </StackPanel>

                            <!-- Toggle User Active Status -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Aktivovat/Deaktivovat uživatele" FontWeight="SemiBold"/>
                                <TextBlock Text="Vyberte uživatele a změňte jeho stav. Deaktivovaní uživatelé se nemohou přihlásit." TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <Button Content="Změnit stav vybraného uživatele"
                                        Command="{x:Bind UserMgmtVM.ToggleUserActiveCommand}"
                                        IsEnabled="{x:Bind UserMgmtVM.IsUserSelected, Mode=OneWay}"/>

                                <!-- Status Message -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind UserMgmtVM.StatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind UserMgmtVM.StatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- System Settings Panel -->
                    <ScrollViewer x:Name="SystemSettingsPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Systémová nastavení" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                Správa tiskárny, EAN scanneru a databáze.
                            </TextBlock>

                            <!-- Printer Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Nastavení tiskárny" FontWeight="SemiBold"/>
                                <TextBox Header="Cesta k tiskárně"
                                         Text="{x:Bind ViewModel.Settings.PrinterPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Např. \\server\tiskarna nebo COM1"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                                <Button Content="Test tisku"
                                        Command="{x:Bind ViewModel.TestPrintCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <!-- Printer Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.TestPrintStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.TestPrintStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>

                            <!-- Scanner Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Nastavení EAN scanneru" FontWeight="SemiBold"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Zadejte cestu k EAN scanneru nebo COM port. Scanner bude použit pro rychlé skenování produktů.
                                </TextBlock>
                                <TextBox Header="Cesta k EAN scanneru"
                                         Text="{x:Bind ViewModel.Settings.ScannerPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Např. COM2 nebo USB"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                            </StackPanel>

                            <!-- Database Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Správa databáze" FontWeight="SemiBold"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Zálohujte databázi do složky Dokumenty/Sklad_2_Backups. Záloha obsahuje všechny produkty, účtenky a nastavení.
                                </TextBlock>
                                <Button Content="Zálohovat databázi"
                                        Command="{x:Bind ViewModel.BackupDatabaseCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <!-- Database Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.BackupStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.BackupStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>

                            <!-- Export to PDF Section (for Finanční úřad) -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Export pro Finanční úřad" FontWeight="SemiBold"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Exportujte přehled účtenek do HTML formátu pro předložení Finančnímu úřadu. HTML lze snadno vytisknout nebo uložit jako PDF.
                                </TextBlock>

                                <!-- Date Range Selection -->
                                <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,8,0,0">
                                    <CalendarDatePicker Header="Od" Date="{x:Bind ViewModel.ExportStartDate, Mode=TwoWay}" HorizontalAlignment="Stretch" Width="200"/>
                                    <CalendarDatePicker Header="Do" Date="{x:Bind ViewModel.ExportEndDate, Mode=TwoWay}" HorizontalAlignment="Stretch" Width="200"/>
                                </StackPanel>

                                <Button Content="Exportovat účtenky do HTML"
                                        Command="{x:Bind ViewModel.ExportReceiptsToHtmlCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <!-- Export Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.ExportStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.ExportStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Categories Panel -->
                    <ScrollViewer x:Name="CategoriesPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Správa kategorií produktů" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <!-- Current Categories List -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Aktuální kategorie:" FontWeight="SemiBold"/>
                                <ListView ItemsSource="{x:Bind CategoryVM.Categories, Mode=OneWay}"
                                          SelectedItem="{x:Bind CategoryVM.SelectedCategory, Mode=TwoWay}"
                                          MaxHeight="200"
                                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                          BorderThickness="1">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="x:String">
                                            <TextBlock Text="{x:Bind}" Padding="8"/>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>

                            <!-- Add Category -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Přidat novou kategorii" FontWeight="SemiBold"/>
                                <TextBox Header="Název kategorie" Text="{x:Bind CategoryVM.NewCategoryName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="Např. Nápoje"/>
                                <Button Content="Přidat kategorii" Command="{x:Bind CategoryVM.AddCategoryCommand}" Style="{StaticResource AccentButtonStyle}"/>

                                <!-- Add Status Message -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind CategoryVM.AddStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind CategoryVM.AddStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{x:Bind CategoryVM.IsAddStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                                </Border>
                            </StackPanel>

                            <!-- Rename Category -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Přejmenovat kategorii" FontWeight="SemiBold"/>
                                <TextBlock Text="Vyberte kategorii ze seznamu výše a zadejte nový název:" TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBox Header="Nový název" Text="{x:Bind CategoryVM.RenameCategoryName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="Nový název kategorie"/>
                                <Button Content="Přejmenovat kategorii" Command="{x:Bind CategoryVM.RenameCategoryCommand}" Style="{StaticResource AccentButtonStyle}"/>
                                <TextBlock Text="Poznámka: Přejmenování automaticky aktualizuje všechny produkty s touto kategorií." TextWrapping="Wrap" FontSize="11" Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>

                                <!-- Rename Status Message -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind CategoryVM.RenameStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind CategoryVM.RenameStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{x:Bind CategoryVM.IsRenameStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                                </Border>
                            </StackPanel>

                            <!-- Delete Category -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource SystemErrorTextColor}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Smazat kategorii" FontWeight="SemiBold" Foreground="{ThemeResource SystemErrorTextColor}"/>
                                <TextBlock Text="Vyberte kategorii ze seznamu a smažte ji. Pozor: Kategorii nelze smazat, pokud je použita u některých produktů!" TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <Button Content="Smazat vybranou kategorii" Command="{x:Bind CategoryVM.DeleteCategoryCommand}" Style="{StaticResource DangerButtonStyle}"/>

                                <!-- Delete Status Message -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind CategoryVM.DeleteStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind CategoryVM.DeleteStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{x:Bind CategoryVM.IsDeleteStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- About Panel -->
                    <ScrollViewer x:Name="AboutPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="O aplikaci" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <!-- App Info Section -->
                            <StackPanel Spacing="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBlock Text="{x:Bind ViewModel.AppName, Mode=OneWay}"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           TextWrapping="Wrap"/>

                                <TextBlock Text="{x:Bind ViewModel.Description, Mode=OneWay}"
                                           TextWrapping="Wrap"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           Margin="0,8,0,0"/>

                                <Border Height="1"
                                        Background="{ThemeResource CardStrokeColorDefaultBrush}"
                                        Margin="0,12,0,12"/>

                                <StackPanel Spacing="8">
                                    <TextBlock>
                                        <Run Text="Verze:" FontWeight="SemiBold"/>
                                        <Run Text="{x:Bind ViewModel.AppVersion, Mode=OneWay}"/>
                                    </TextBlock>

                                    <TextBlock>
                                        <Run Text="Vytvořil:" FontWeight="SemiBold"/>
                                        <Run Text="{x:Bind ViewModel.Author, Mode=OneWay}"/>
                                    </TextBlock>

                                    <TextBlock>
                                        <Run Text="Kontakt:" FontWeight="SemiBold"/>
                                        <Run Text="{x:Bind ViewModel.ContactEmail, Mode=OneWay}"/>
                                    </TextBlock>

                                    <TextBlock Text="{x:Bind ViewModel.Copyright, Mode=OneWay}"
                                               FontSize="12"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Margin="0,8,0,0"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Tech Stack Section -->
                            <StackPanel Spacing="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBlock Text="Technologie" FontWeight="SemiBold" FontSize="16"/>

                                <StackPanel Spacing="4">
                                    <TextBlock>
                                        <Run Text="•" FontWeight="Bold"/>
                                        <Run Text=" WinUI 3 (Windows App SDK 1.5)"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="•" FontWeight="Bold"/>
                                        <Run Text=" .NET 8.0"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="•" FontWeight="Bold"/>
                                        <Run Text=" SQLite databáze"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="•" FontWeight="Bold"/>
                                        <Run Text=" MVVM architektura (CommunityToolkit.Mvvm)"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="•" FontWeight="Bold"/>
                                        <Run Text=" Entity Framework Core 8"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>

                            <!-- Features Section -->
                            <StackPanel Spacing="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBlock Text="Hlavní funkce" FontWeight="SemiBold" FontSize="16"/>

                                <StackPanel Spacing="4">
                                    <TextBlock>
                                        <Run Text="✓" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Správa produktů a skladu"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="✓" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Prodejní systém s pokladnou"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="✓" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Tisk účtenek"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="✓" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Evidence DPH"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="✓" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Správa vratek"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="✓" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Denní uzavírky"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="✓" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Záloha databáze"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>

                            <!-- License Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBlock Text="Licence" FontWeight="SemiBold" FontSize="16"/>
                                <TextBlock TextWrapping="Wrap"
                                           FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Tento software je poskytován "tak jak je", bez jakýchkoliv záruk. Používejte na vlastní riziko.
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </NavigationView>
    </Grid>
</Page>