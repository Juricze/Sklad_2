<Page
    x:Name="page"
    x:Class="Sklad_2.Views.NastaveniPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Sklad_2.Models"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Padding="24">
            <NavigationView x:Name="NavView"
                PaneDisplayMode="Top"
                IsSettingsVisible="False"
                IsBackButtonVisible="Collapsed"
                ItemInvoked="NavView_ItemInvoked"
                AlwaysShowHeader="False">
                <NavigationView.MenuItems>
                    <NavigationViewItem Content="Firemn√≠ √∫daje" Tag="Company" IsSelected="True"/>
                    <NavigationViewItem Content="Sazby DPH" Tag="VAT" Visibility="{x:Bind ViewModel.IsVatPayer, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}"/>
                    <NavigationViewItem Content="Kategorie" Tag="Categories" Visibility="{x:Bind ViewModel.IsAdmin, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}"/>
                    <NavigationViewItem Content="U≈æivatel√©" Tag="Users" Visibility="{x:Bind ViewModel.IsAdmin, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}"/>
                    <NavigationViewItem Content="Syst√©m" Tag="System"/>
                    <NavigationViewItem Content="O aplikaci" Tag="About"/>
                </NavigationView.MenuItems>

                <Grid Padding="0,12,0,0">
                    <!-- Company Settings Panel -->
                    <ScrollViewer x:Name="CompanySettingsPanel" Visibility="Visible" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Firemn√≠ √∫daje" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                Nastavte z√°kladn√≠ informace o va≈°√≠ firmƒõ. Tyto √∫daje se zobrazuj√≠ na √∫ƒçtenk√°ch a dokladech.
                            </TextBlock>

                            <!-- Company Info Form -->
                            <StackPanel Spacing="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBox Header="N√°zev obchodu"
                                         Text="{x:Bind ViewModel.Settings.ShopName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Nap≈ô. M≈Øj obchod s.r.o."
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <TextBox Header="Adresa"
                                         Text="{x:Bind ViewModel.Settings.ShopAddress, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Nap≈ô. Hlavn√≠ 123, 110 00 Praha"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <TextBox Header="Iƒå (Identifikaƒçn√≠ ƒç√≠slo)"
                                         Text="{x:Bind ViewModel.Settings.CompanyId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Nap≈ô. 12345678"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <TextBox Header="DIƒå (Da≈àov√© identifikaƒçn√≠ ƒç√≠slo)"
                                         Text="{x:Bind ViewModel.Settings.VatId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Nap≈ô. CZ12345678"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <ToggleSwitch Header="Pl√°tce DPH"
                                              OnContent="Ano"
                                              OffContent="Ne"
                                              IsOn="{x:Bind ViewModel.Settings.IsVatPayer, Mode=TwoWay}"
                                              IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                            </StackPanel>

                            <!-- Save Button -->
                            <Button Content="Ulo≈æit firemn√≠ √∫daje"
                                    Command="{x:Bind ViewModel.SaveCompanyInfoCommand}"
                                    Style="{StaticResource AccentButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                            <!-- Status Message -->
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="12"
                                    Visibility="{x:Bind ViewModel.CompanyStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                <TextBlock Text="{x:Bind ViewModel.CompanyStatusMessage, Mode=OneWay}"
                                           TextWrapping="Wrap"
                                           Foreground="{x:Bind ViewModel.IsCompanyStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- VAT Settings Panel -->
                    <ScrollViewer x:Name="VatSettingsPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Konfigurace sazeb DPH" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                Nastavte sazby DPH pro jednotliv√© kategorie produkt≈Ø. Zmƒõny kategori√≠ se automaticky projev√≠ v tomto seznamu.
                            </TextBlock>

                            <!-- VAT Configs List -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <Grid ColumnDefinitions="*,Auto" Padding="0,0,0,12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,0,0,2">
                                    <TextBlock Grid.Column="0" Text="Kategorie" FontWeight="SemiBold" />
                                    <TextBlock Grid.Column="1" Text="Sazba DPH (%)" FontWeight="SemiBold" />
                                </Grid>
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.VatConfigs, Mode=OneWay}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate x:DataType="models:VatConfig">
                                            <Grid ColumnDefinitions="*,Auto" Padding="0,12,0,12" VerticalAlignment="Center" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,0,0,1">
                                                <TextBlock Grid.Column="0" Text="{x:Bind CategoryName}" VerticalAlignment="Center" FontSize="14"/>
                                                <NumberBox Grid.Column="1"
                                                           Value="{x:Bind Rate, Mode=TwoWay}"
                                                           SpinButtonPlacementMode="Compact"
                                                           SmallChange="1"
                                                           LargeChange="5"
                                                           Minimum="0"
                                                           Maximum="100"
                                                           Width="140"
                                                           IsEnabled="{Binding DataContext.IsAdmin, ElementName=page, Mode=OneWay}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </StackPanel>

                            <!-- Save Button -->
                            <Button Content="Ulo≈æit sazby DPH"
                                    Command="{x:Bind ViewModel.SaveVatConfigsCommand}"
                                    Style="{StaticResource AccentButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                            <!-- Status Message -->
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="12"
                                    Visibility="{x:Bind ViewModel.VatStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                <TextBlock Text="{x:Bind ViewModel.VatStatusMessage, Mode=OneWay}"
                                           TextWrapping="Wrap"
                                           Foreground="{x:Bind ViewModel.IsVatStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Users Panel -->
                    <ScrollViewer x:Name="UsersPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Spr√°va u≈æivatel≈Ø" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                Spravujte u≈æivatelsk√© √∫ƒçty pro p≈ô√≠stup do aplikace. Ka≈æd√Ω u≈æivatel m√° jedineƒçn√© p≈ôihla≈°ovac√≠ jm√©no, zobrazovan√© jm√©no a roli.
                            </TextBlock>

                            <!-- Users List -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="U≈æivatel√©:" FontWeight="SemiBold"/>
                                <ListView ItemsSource="{x:Bind UserMgmtVM.Users, Mode=OneWay}"
                                          SelectedItem="{x:Bind UserMgmtVM.SelectedUser, Mode=TwoWay}"
                                          MaxHeight="300"
                                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                          BorderThickness="1">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="models:User">
                                            <Grid ColumnSpacing="12" Padding="8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="2*"/>
                                                    <ColumnDefinition Width="2*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <FontIcon Grid.Column="0" Glyph="{x:Bind Role, Converter={StaticResource RoleToIconConverter}}" FontSize="16"/>
                                                <TextBlock Grid.Column="1" Text="{x:Bind Username}" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="2" Text="{x:Bind DisplayName}" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="3" Text="{x:Bind RoleDisplayName}" VerticalAlignment="Center"/>
                                                <Border Grid.Column="4"
                                                        Background="{x:Bind IsActive, Converter={StaticResource BooleanToColorConverter}}"
                                                        CornerRadius="10"
                                                        Padding="8,2">
                                                    <TextBlock Text="{x:Bind StatusDisplayName}"
                                                               FontSize="11"
                                                               Foreground="White"
                                                               FontWeight="SemiBold"/>
                                                </Border>
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>

                            <!-- Add User -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="P≈ôidat nov√©ho u≈æivatele" FontWeight="SemiBold"/>
                                <Button Content="+ P≈ôidat u≈æivatele"
                                        Command="{x:Bind UserMgmtVM.AddUserCommand}"
                                        Style="{StaticResource AccentButtonStyle}"/>
                            </StackPanel>

                            <!-- Edit User -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Upravit u≈æivatele" FontWeight="SemiBold"/>
                                <TextBlock Text="Vyberte u≈æivatele ze seznamu a upravte jeho √∫daje:" TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <Button Content="Upravit vybran√©ho u≈æivatele"
                                        Command="{x:Bind UserMgmtVM.EditUserCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        IsEnabled="{x:Bind UserMgmtVM.IsUserSelected, Mode=OneWay}"/>
                            </StackPanel>

                            <!-- Toggle User Active Status -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Aktivovat/Deaktivovat u≈æivatele" FontWeight="SemiBold"/>
                                <TextBlock Text="Vyberte u≈æivatele a zmƒõ≈àte jeho stav. Deaktivovan√≠ u≈æivatel√© se nemohou p≈ôihl√°sit." TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <Button Content="Zmƒõnit stav vybran√©ho u≈æivatele"
                                        Command="{x:Bind UserMgmtVM.ToggleUserActiveCommand}"
                                        IsEnabled="{x:Bind UserMgmtVM.IsUserSelected, Mode=OneWay}"/>

                                <!-- Status Message -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind UserMgmtVM.StatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind UserMgmtVM.StatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- System Settings Panel -->
                    <ScrollViewer x:Name="SystemSettingsPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Syst√©mov√° nastaven√≠" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                Spr√°va tisk√°rny, EAN scanneru a datab√°ze.
                            </TextBlock>

                            <!-- Printer Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Nastaven√≠ tisk√°rny" FontWeight="SemiBold"/>
                                <TextBox Header="COM port tisk√°rny"
                                         Text="{x:Bind ViewModel.Settings.PrinterPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Nap≈ô. COM1, COM3, COM5"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                                <TextBlock Text="Pozn√°mka: Nainstalujte Epson Virtual COM Port driver, pokud tisk√°rna nen√≠ viditeln√° jako COM port."
                                           FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           TextWrapping="Wrap"/>
                                <Grid ColumnDefinitions="*,8,*">
                                    <Button Content="Ulo≈æit"
                                            Command="{x:Bind ViewModel.SavePrinterSettingsCommand}"
                                            HorizontalAlignment="Stretch"
                                            IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                                    <Button Grid.Column="2"
                                            Content="Test tisku"
                                            Command="{x:Bind ViewModel.TestPrintCommand}"
                                            Style="{StaticResource AccentButtonStyle}"
                                            HorizontalAlignment="Stretch"
                                            IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                                </Grid>

                                <!-- Printer Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.TestPrintStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.TestPrintStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>

                            <!-- Backup Path Configuration -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Nastaven√≠ cesty pro z√°lohy a exporty" FontWeight="SemiBold"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Nastavte vlastn√≠ slo≈æku pro ukl√°d√°n√≠ z√°loh datab√°ze a export≈Ø pro F√ö.
                                    Pokud cestu nenastav√≠te, pou≈æije se OneDrive (pokud je dostupn√Ω) nebo slo≈æka Dokumenty.
                                </TextBlock>

                                <!-- Active Backup Path Display -->
                                <Border Background="{ThemeResource LayerFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="12"
                                        Margin="0,4,0,4">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="üìÅ Aktu√°lnƒõ pou≈æ√≠van√° cesta" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock x:Name="ActiveBackupPathText"
                                                   Text="{x:Bind ViewModel.ActiveBackupPath, Mode=OneWay}"
                                                   TextWrapping="Wrap"
                                                   FontSize="11"
                                                   Foreground="{x:Bind ViewModel.IsBackupPathConfigured, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}, ConverterParameter=BackupPath}"
                                                   FontFamily="Consolas"
                                                   Loaded="ActiveBackupPathText_Loaded">
                                            <TextBlock.Resources>
                                                <Storyboard x:Key="BlinkErrorAnimation" RepeatBehavior="Forever">
                                                    <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="Opacity" Duration="0:0:1">
                                                        <DiscreteDoubleKeyFrame KeyTime="0:0:0" Value="1.0"/>
                                                        <DiscreteDoubleKeyFrame KeyTime="0:0:0.5" Value="0.3"/>
                                                    </DoubleAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </TextBlock.Resources>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <TextBox Header="Cesta k z√°lo≈æn√≠ slo≈æce"
                                         Text="{x:Bind ViewModel.Settings.BackupPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Nap≈ô. C:\Z√°lohy nebo pr√°zdn√© pro automatickou detekci"
                                         IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                                <Button Content="Proch√°zet slo≈æky..."
                                        Click="BrowseBackupFolderButton_Click"
                                        HorizontalAlignment="Left"
                                        IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                                <Button Content="Ulo≈æit cestu"
                                        Command="{x:Bind ViewModel.SaveBackupPathCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        HorizontalAlignment="Stretch"
                                        Margin="0,8,0,0"
                                        IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <!-- Backup Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.BackupStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.BackupStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>

                            <!-- Database Sync Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Synchronizace datab√°ze" FontWeight="SemiBold"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Datab√°ze se automaticky z√°lohuje p≈ôi zav≈ôen√≠ aplikace do nastaven√© slo≈æky.
                                    Tlaƒç√≠tko n√≠≈æe provede okam≈æitou synchronizaci.
                                </TextBlock>
                                <Button Content="Synchronizovat nyn√≠"
                                        Command="{x:Bind ViewModel.BackupDatabaseCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <!-- Database Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.BackupStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.BackupStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>

                            <!-- Manual Discounts Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Ruƒçn√≠ slevy" FontWeight="SemiBold"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Povolte nebo zaka≈æte mo≈ænost zad√°v√°n√≠ ruƒçn√≠ch slev p≈ôi prodeji. Pokud je vypnuto, prodavaƒçi nebudou moci upravovat ceny produkt≈Ø p≈ôi prodeji.
                                </TextBlock>
                                <ToggleSwitch Header="Povolit ruƒçn√≠ slevy"
                                              OnContent="Povoleno"
                                              OffContent="Zak√°z√°no"
                                              IsOn="{x:Bind ViewModel.Settings.AllowManualDiscounts, Mode=TwoWay}"
                                              IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>
                                <Button Content="Ulo≈æit nastaven√≠"
                                        Command="{x:Bind ViewModel.SaveManualDiscountsCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        HorizontalAlignment="Stretch"
                                        Margin="0,8,0,0"
                                        IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <!-- Manual Discounts Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.ManualDiscountsStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.ManualDiscountsStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>

                            <!-- Export to PDF Section (for Finanƒçn√≠ √∫≈ôad) -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Export pro Finanƒçn√≠ √∫≈ôad" FontWeight="SemiBold"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Exportujte p≈ôehled √∫ƒçtenek do HTML form√°tu pro p≈ôedlo≈æen√≠ Finanƒçn√≠mu √∫≈ôadu. HTML lze snadno vytisknout nebo ulo≈æit jako PDF.
                                </TextBlock>

                                <!-- Date Range Selection -->
                                <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,8,0,0">
                                    <CalendarDatePicker Header="Od" Date="{x:Bind ViewModel.ExportStartDate, Mode=TwoWay}" HorizontalAlignment="Stretch" Width="200"/>
                                    <CalendarDatePicker Header="Do" Date="{x:Bind ViewModel.ExportEndDate, Mode=TwoWay}" HorizontalAlignment="Stretch" Width="200"/>
                                </StackPanel>

                                <Button Content="Exportovat √∫ƒçtenky do HTML"
                                        Command="{x:Bind ViewModel.ExportReceiptsToHtmlCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind ViewModel.IsAdmin, Mode=OneWay}"/>

                                <!-- Export Status -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind ViewModel.ExportStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind ViewModel.ExportStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Categories Panel -->
                    <ScrollViewer x:Name="CategoriesPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="Spr√°va kategori√≠ produkt≈Ø" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <!-- Current Categories List -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Aktu√°ln√≠ kategorie:" FontWeight="SemiBold"/>
                                <ListView ItemsSource="{x:Bind CategoryVM.Categories, Mode=OneWay}"
                                          SelectedItem="{x:Bind CategoryVM.SelectedCategory, Mode=TwoWay}"
                                          MaxHeight="200"
                                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                          BorderThickness="1">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="x:String">
                                            <TextBlock Text="{x:Bind}" Padding="8"/>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>

                            <!-- Add Category -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="P≈ôidat novou kategorii" FontWeight="SemiBold"/>
                                <TextBox Header="N√°zev kategorie" Text="{x:Bind CategoryVM.NewCategoryName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="Nap≈ô. N√°poje"/>
                                <Button Content="P≈ôidat kategorii" Command="{x:Bind CategoryVM.AddCategoryCommand}" Style="{StaticResource AccentButtonStyle}"/>

                                <!-- Add Status Message -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind CategoryVM.AddStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind CategoryVM.AddStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{x:Bind CategoryVM.IsAddStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                                </Border>
                            </StackPanel>

                            <!-- Rename Category -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="P≈ôejmenovat kategorii" FontWeight="SemiBold"/>
                                <TextBlock Text="Vyberte kategorii ze seznamu v√Ω≈°e a zadejte nov√Ω n√°zev:" TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBox Header="Nov√Ω n√°zev" Text="{x:Bind CategoryVM.RenameCategoryName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="Nov√Ω n√°zev kategorie"/>
                                <Button Content="P≈ôejmenovat kategorii" Command="{x:Bind CategoryVM.RenameCategoryCommand}" Style="{StaticResource AccentButtonStyle}"/>
                                <TextBlock Text="Pozn√°mka: P≈ôejmenov√°n√≠ automaticky aktualizuje v≈°echny produkty s touto kategori√≠." TextWrapping="Wrap" FontSize="11" Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>

                                <!-- Rename Status Message -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind CategoryVM.RenameStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind CategoryVM.RenameStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{x:Bind CategoryVM.IsRenameStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                                </Border>
                            </StackPanel>

                            <!-- Delete Category -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource SystemErrorTextColor}" BorderThickness="1" Padding="12" CornerRadius="4">
                                <TextBlock Text="Smazat kategorii" FontWeight="SemiBold" Foreground="{ThemeResource SystemErrorTextColor}"/>
                                <TextBlock Text="Vyberte kategorii ze seznamu a sma≈æte ji. Pozor: Kategorii nelze smazat, pokud je pou≈æita u nƒõkter√Ωch produkt≈Ø!" TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <Button Content="Smazat vybranou kategorii" Command="{x:Bind CategoryVM.DeleteCategoryCommand}" Style="{StaticResource DangerButtonStyle}"/>

                                <!-- Delete Status Message -->
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8"
                                        Margin="0,8,0,0"
                                        Visibility="{x:Bind CategoryVM.DeleteStatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                                    <TextBlock Text="{x:Bind CategoryVM.DeleteStatusMessage, Mode=OneWay}"
                                               TextWrapping="Wrap"
                                               FontSize="13"
                                               Foreground="{x:Bind CategoryVM.IsDeleteStatusError, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- About Panel -->
                    <ScrollViewer x:Name="AboutPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="24" Padding="0,0,12,0">
                            <TextBlock Text="O aplikaci" Style="{ThemeResource SubtitleTextBlockStyle}"/>

                            <!-- App Info Section -->
                            <StackPanel Spacing="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBlock Text="{x:Bind ViewModel.AppName, Mode=OneWay}"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           TextWrapping="Wrap"/>

                                <TextBlock Text="{x:Bind ViewModel.Description, Mode=OneWay}"
                                           TextWrapping="Wrap"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           Margin="0,8,0,0"/>

                                <Border Height="1"
                                        Background="{ThemeResource CardStrokeColorDefaultBrush}"
                                        Margin="0,12,0,12"/>

                                <StackPanel Spacing="8">
                                    <TextBlock>
                                        <Run Text="Verze:" FontWeight="SemiBold"/>
                                        <Run Text="{x:Bind ViewModel.AppVersion, Mode=OneWay}"/>
                                    </TextBlock>

                                    <TextBlock>
                                        <Run Text="Vytvo≈ôil:" FontWeight="SemiBold"/>
                                        <Run Text="{x:Bind ViewModel.Author, Mode=OneWay}"/>
                                    </TextBlock>

                                    <TextBlock>
                                        <Run Text="Kontakt:" FontWeight="SemiBold"/>
                                        <Run Text="{x:Bind ViewModel.ContactEmail, Mode=OneWay}"/>
                                    </TextBlock>

                                    <TextBlock Text="{x:Bind ViewModel.Copyright, Mode=OneWay}"
                                               FontSize="12"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Margin="0,8,0,0"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Tech Stack Section -->
                            <StackPanel Spacing="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBlock Text="Technologie" FontWeight="SemiBold" FontSize="16"/>

                                <StackPanel Spacing="4">
                                    <TextBlock>
                                        <Run Text="‚Ä¢" FontWeight="Bold"/>
                                        <Run Text=" WinUI 3 (Windows App SDK 1.5)"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚Ä¢" FontWeight="Bold"/>
                                        <Run Text=" .NET 8.0"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚Ä¢" FontWeight="Bold"/>
                                        <Run Text=" SQLite datab√°ze"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚Ä¢" FontWeight="Bold"/>
                                        <Run Text=" MVVM architektura (CommunityToolkit.Mvvm)"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚Ä¢" FontWeight="Bold"/>
                                        <Run Text=" Entity Framework Core 8"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>

                            <!-- Features Section -->
                            <StackPanel Spacing="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBlock Text="Hlavn√≠ funkce" FontWeight="SemiBold" FontSize="16"/>

                                <StackPanel Spacing="4">
                                    <TextBlock>
                                        <Run Text="‚úì" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Spr√°va produkt≈Ø a skladu"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚úì" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Prodejn√≠ syst√©m s pokladnou"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚úì" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Tisk √∫ƒçtenek"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚úì" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Evidence DPH"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚úì" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Spr√°va vratek"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚úì" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Denn√≠ uzav√≠rky"/>
                                    </TextBlock>
                                    <TextBlock>
                                        <Run Text="‚úì" FontWeight="Bold" Foreground="#34C759"/>
                                        <Run Text=" Z√°loha datab√°ze"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>

                            <!-- License Section -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="16" CornerRadius="4">
                                <TextBlock Text="Licence" FontWeight="SemiBold" FontSize="16"/>
                                <TextBlock TextWrapping="Wrap"
                                           FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    Tento software je poskytov√°n "tak jak je", bez jak√Ωchkoliv z√°ruk. Pou≈æ√≠vejte na vlastn√≠ riziko.
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </NavigationView>
    </Grid>
</Page>